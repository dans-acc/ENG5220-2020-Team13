<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BeeSafe Project: Build guide</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen_html_style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../beeSmall.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">BeeSafe Project
   &#160;<span id="projectnumber">v1.0</span>
   </div>
   <div id="projectbrief">Low-cost tracking device.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('d1/d6f/md_doc_wiki__build-_guide.html','../../');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Build guide </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This guide explains all the necessary steps that need to be taken to be able to recreate, or build and install the BeeSafe project.</p>
<h2>Hardware</h2>
<h3>Logging into the Raspberry Pi</h3>
<p>When connected to the pi for the first time, if logging in as normal user the default login credentials are: <br />
 </p><div class="fragment"><div class="line">username: pi</div><div class="line">password: raspberry</div></div><!-- fragment --><p> <br />
 <b>Note</b> : The above and all commands further on are as user <code>pi</code>, NOT <code>root</code>. If <code>root</code>, leave <code>sudo</code>. <br />
 <b>Note</b> : To change the default settings and secure your Raspberry Pi, follow this article: <a href="https://www.raspberrypi.org/documentation/configuration/security.md">https://www.raspberrypi.org/documentation/configuration/security.md</a></p>
<h3>Enable SSH</h3>
<p>To set up SSH first, type </p><div class="fragment"><div class="line">sudo raspi-config</div></div><!-- fragment --><p> then select </p><div class="fragment"><div class="line">5 Interfacing options</div></div><!-- fragment --><p> then select </p><div class="fragment"><div class="line">P2 SSH</div></div><!-- fragment --><p> then press <code>Yes</code> for <code>Would you like SSH server to be enabled?</code> <br />
<br />
 Then get you Pi's IP address by typing <br />
 </p><div class="fragment"><div class="line">ifconfig</div></div><!-- fragment --><p> and note the address that goes something like <code>192.168.x.x</code> <br />
 </p><h3>Remote Connection and Port Forwarding</h3>
<p><b>Note</b>: you might need to set up port forwarding on your router, for which you need to do the following: </p><ol>
<li>
Navigate to your routerâ€™s homepage in your browser, and log in (the address is usually <code>192.168.0.1</code>, but check with your router manufacturer/ISP) </li>
<li>
Find the page that handles security or port issues </li>
<li>
On that page, you'll see a list similar to the following. Add your Pi's IP address and a port or port range of your choosing, which people need to use when connecting to your Pi from outside your network: <table class="doxtable">
<tr>
<th colspan="2">Local </th><th colspan="2">External </th><th colspan="2"></th></tr>
<tr>
<td>IP address<br />
 </td><td>Port Range </td><td>Port Range<br />
 </td><td>Protocol </td><td>Enabled </td><td>Delete  </td></tr>
<tr>
<td>[PI IP address] </td><td>22-22 </td><td>[port]-[port]<br />
 </td><td>TCP </td><td>Yes </td><td></td></tr>
</table>
<b>Note</b> : This is only one example. For more information, check out the following article: <a href="https://pimylifeup.com/raspberry-pi-port-forwarding/">https://pimylifeup.com/raspberry-pi-port-forwarding/</a>  </li>
<li>
Then save the settings and log out of your router. </li>
</ol>
<p>On your laptop, install Putty (<a href="https://www.putty.org/">https://www.putty.org/</a>), then open Putty and enter the IP address you noted down in the field "Host Name or IP address" and in the radio button menu below, select "SSH". The port should automatically set to "22", but if it does not, set it manually. Afterwards click "Open" to connect.</p>
<h3>Set up Wifi on the Pi</h3>
<p>To set the wifi on your Pi, type </p><div class="fragment"><div class="line">sudo nano /etc/wpa_supplicant/wpa_supplicant.conf</div></div><!-- fragment --><p> and when the file opens, add your wifi credentials (network name and password) to the file. If connecting to a hidden network, add the line <code>scan_ssid=1</code> to the file at the end. It should look something like this: </p><div class="fragment"><div class="line">network={</div><div class="line">    ssid=&quot;name&quot;</div><div class="line">    psk=&quot;password&quot;</div><div class="line">    scan_ssid=1</div><div class="line">}</div></div><!-- fragment --><p> To add multiple networks, just repeat the above for each, with a separate network item for each.</p>
<h2>Software</h2>
<p>To build the software component of this project, take the following steps:</p>
<h3>Create an account on Github</h3>
<p>You can clone the repository without an account, however to push contributions, an account is required. You can do so on the following <a href="https://github.com/join">link</a>. <br />
</p>
<h3>Installing dependencies</h3>
<p>The following section explains how to install the dependencies. </p><blockquote class="doxtable">
<p><b>Note</b> : If you already know your way around installing packages and setting up Git on Linux, just clone the BeeSafe repository from Github using <code>git clone <a href="https://github.com/itsBelinda/ENG5220-2020-Team13">https://github.com/itsBelinda/ENG5220-2020-Team13</a></code> , navigate into the repository, and in the root folder run the <code>installBeeSafe.sh</code> script. This installs all the required dependencies for the project that is described in the following 2 sections. You can skip ahead to the <code>Building the project</code> section now. <br />
 <b>Note:</b> For optional dependencies, you can choose to install them or not, by uncommenting or commenting them in the installation script. </p>
</blockquote>
<p>&gt;**Note: this project uses a bootloader to install dependencies and run the software. If you wish to use that, please skip to the section <code>Bootloading</code> as the following chapters will describe how to build the project without the specified bootloader we included in the project repository.**</p>
<h4>Before start</h4>
<p>To install some of the necessary packages, carry out the following steps: <br />
 (to check what packages you already have installed, type: <code>apt list --installed</code> ) <br />
 To ensure you have enough space on your pi, first type <code>df -h</code>, then you'll see a breakdown of filesystems and spaces used and available. <br />
<br />
</p>
<h4>Setting up</h4>
<p>Then, if your pi is older or haven't been used in a while, use the following commands where deemed necessary: <br />
 **<code>sudo apt-get update</code>** : downloads the package lists from the repositories and "updates" them to get information on the newest versions of packages and their dependencies. <br />
 **<code>sudo apt-get upgrade</code>** : will fetch new versions of packages existing on the machine if APT knows about these new versions by way of apt-get update. <br />
 **<code>sudo apt-get dist-upgrade</code>** : will do the same job which is done by apt-get upgrade, plus it will also intelligently handle the dependencies, so it might remove obsolete packages or add new ones. <br />
 <b>Note</b> : To find out more which one you need and get a more thorough description, see: <a href="https://askubuntu.com/questions/222348/what-does-sudo-apt-get-update-do">https://askubuntu.com/questions/222348/what-does-sudo-apt-get-update-do</a></p>
<h4>Install Git</h4>
<p>To get any packages e.g. from github, you'll need Git. To install Git, type </p><div class="fragment"><div class="line">sudo apt-get install git</div></div><!-- fragment --><h4>Install packages necessary for the project</h4>
<p>To get started with C/C++ development, you can get the minimal necessary packages (gcc/g++: compilers, make: compilation utility, libc6-dev: GNU C library with development libraries and header files needed) by typing </p><div class="fragment"><div class="line">sudo apt-get install build-essential</div></div><!-- fragment --><p> To recreate the program, you'll also need to install the following packages: </p><div class="fragment"><div class="line">sudo apt-get install cmake openssl libcpprest-dev</div></div><!-- fragment --><p> (core packages to have the program running) </p><div class="fragment"><div class="line">sudo apt-get install flex bison doxygen graphviz libreadline6-dev lcov</div></div><!-- fragment --><p> (necessary packages necessary for Doxygen and Codecov)</p>
<h4>Install optional packages</h4>
<p>A non-exaustive list of stuff you might need and/or are handy is the following: </p><div class="fragment"><div class="line">sudo apt install screen npm</div></div><!-- fragment --><p> Screen can act as a serial terminal program to test the operations of the UART with, and npm can be used to install packages such as the github-wiki-sidebar with which you can create custom Github wiki sidebars. </p><h4>Tidying up</h4>
<p>Once you've done installing packages, you can tidy up and clean the local repository of retrieved package files that are left in /var/cache by typing </p><div class="fragment"><div class="line">sudo apt-get clean</div></div><!-- fragment --><h3>Setting up Git on the Pi</h3>
<p>To configure your git to connect to your account, add your credentials by typing </p><div class="fragment"><div class="line">git config --global user.name &quot;yourusername&quot;</div><div class="line">git config --global user.email &quot;youremail@email.com&quot;</div></div><!-- fragment --><p> For more Git configuration options, check out the following link: <a href="https://www.atlassian.com/git/tutorials/setting-up-a-repository/git-config">https://www.atlassian.com/git/tutorials/setting-up-a-repository/git-config</a></p>
<h3>Clone the repository</h3>
<p>To get the BeeSafe project, clone the Github repository by typing ``<code> git clone <a href="https://github.com/itsBelinda/ENG5220-2020-Team13">https://github.com/itsBelinda/ENG5220-2020-Team13</a></code> </p><div class="fragment"><div class="line">### Enabling UART</div><div class="line">The Raspberry Pi 3B used for this project (also RPi 4) has 2 options which can be used for UART communication, and they are currently used by the following services:</div></div><!-- fragment --><p> /dev/ttyAMA0 -&gt; Bluetooth /dev/ttyS0 -&gt; GPIO serial </p><div class="fragment"><div class="line">The choice is up for the implementer, but in this project we enabled ttyS0.</div><div class="line">&lt;br&gt;&lt;br&gt;</div><div class="line">To get started with UART, you need to configure a few things before starting writing code. First, if you use RPi 3 and above, open the file</div></div><!-- fragment --><p> sudo nano /boot/config.txt </p><div class="fragment"><div class="line">and if not already there, add the option</div></div><!-- fragment --><p> enable_uart=1 </p><div class="fragment"><div class="line">to the end of the file.</div><div class="line">&lt;br&gt;</div><div class="line">You will also need to disable Linux&#39;s console use of UART by typing</div></div><!-- fragment --><p> sudo raspi-config </p><div class="fragment"><div class="line">then selecting</div></div><!-- fragment --><p> 5 Interfacing Options </p><div class="fragment"><div class="line">followed by selecting</div></div><!-- fragment --><p> P6 Serial </p><div class="fragment"><div class="line">and then when asked &lt;i&gt;&quot;Would you like a login shell to be accessible over serial?&quot;&lt;/i&gt;, select</div></div><!-- fragment --><p> No </p><div class="fragment"><div class="line">but when asked &lt;i&gt;&quot;Would you like the serial port hardware to be enabled?&quot;&lt;/i&gt;, select</div></div><!-- fragment --><p> Yes </p><div class="fragment"><div class="line">then</div></div><!-- fragment --><p> OK </p><div class="fragment"><div class="line">&lt;br&gt;&lt;br&gt;</div><div class="line">**Note: With this you set up UART communications on `ttyS0`. If you want it on `ttyAMA0`, continue with the following steps.**</div><div class="line">&lt;br&gt; </div><div class="line">For enabling ttyAMA0, we also need to manually change the settings, so edit the kernel command line with</div></div><!-- fragment --><p> sudo nano /boot/cmdline.txt </p><div class="fragment"><div class="line">, find the console entry that refers to the serial0 device, and remove it, including the baud rate setting. It will look something like</div></div><!-- fragment --><p> console=serial0,115200 </p><div class="fragment"><div class="line">**Note: This file must only contain 1 line, do not split the line when editing, and do not try to add comments to the file. Make sure the rest of the line remains the same, as errors in this configuration can stop the Raspberry Pi from booting.**</div><div class="line">&lt;br&gt;</div><div class="line">We also need to disable Bluetooth and restore ttyAMA0 to GPIOs 14 and 15, by typing</div></div><!-- fragment --><p> sudo systemctl disable hciuart </p><div class="fragment"><div class="line">then navigating to</div></div><!-- fragment --><p> sudo nano /boot/config.txt </p><div class="fragment"><div class="line">and adding the following to the end</div></div><!-- fragment --><p> dtoverlay=disable-bt </p><div class="fragment"><div class="line">&lt;br&gt;&lt;br&gt;</div><div class="line">In some cases it might be necessary to disable the services running on these ports, since we are not using the serial ports for console, by typing:</div></div><!-- fragment --><p> sudo systemctl stop <a href="#" onclick="location.href='mai'+'lto:'+'ser'+'ia'+'l-g'+'et'+'ty@'+'tt'+'yAM'+'A0'+'.se'+'rv'+'ice'; return false;">seria<span style="display: none;">.nosp@m.</span>l-ge<span style="display: none;">.nosp@m.</span>tty@t<span style="display: none;">.nosp@m.</span>tyAM<span style="display: none;">.nosp@m.</span>A0.se<span style="display: none;">.nosp@m.</span>rvic<span style="display: none;">.nosp@m.</span>e</a> sudo systemctl disable <a href="#" onclick="location.href='mai'+'lto:'+'ser'+'ia'+'l-g'+'et'+'ty@'+'tt'+'yAM'+'A0'+'.se'+'rv'+'ice'; return false;">seria<span style="display: none;">.nosp@m.</span>l-ge<span style="display: none;">.nosp@m.</span>tty@t<span style="display: none;">.nosp@m.</span>tyAM<span style="display: none;">.nosp@m.</span>A0.se<span style="display: none;">.nosp@m.</span>rvic<span style="display: none;">.nosp@m.</span>e</a> </p><div class="fragment"><div class="line">and/or</div></div><!-- fragment --><p> sudo systemctl stop <a href="#" onclick="location.href='mai'+'lto:'+'ser'+'ia'+'l-g'+'et'+'ty@'+'tt'+'yS0'+'.s'+'erv'+'ic'+'e'; return false;">seria<span style="display: none;">.nosp@m.</span>l-ge<span style="display: none;">.nosp@m.</span>tty@t<span style="display: none;">.nosp@m.</span>tyS0<span style="display: none;">.nosp@m.</span>.serv<span style="display: none;">.nosp@m.</span>ice</a> sudo systemctl disable <a href="#" onclick="location.href='mai'+'lto:'+'ser'+'ia'+'l-g'+'et'+'ty@'+'tt'+'yS0'+'.s'+'erv'+'ic'+'e'; return false;">seria<span style="display: none;">.nosp@m.</span>l-ge<span style="display: none;">.nosp@m.</span>tty@t<span style="display: none;">.nosp@m.</span>tyS0<span style="display: none;">.nosp@m.</span>.serv<span style="display: none;">.nosp@m.</span>ice</a> </p><div class="fragment"><div class="line">&lt;br&gt;&lt;br&gt;</div><div class="line">You can make sure it worked by typing</div></div><!-- fragment --><p> dmesg | grep tty </p><div class="fragment"><div class="line">and if you don&#39;t see </div></div><!-- fragment --><p> console [ttyAMA0] enabled </p><div class="fragment"><div class="line">or</div></div><!-- fragment --><p> console [ttyS0] enabled </p><div class="fragment"><div class="line">but still see both ttyS0 and ttyAMA0 listed as serials;</div><div class="line">&lt;br&gt;</div><div class="line">OR after typing</div></div><!-- fragment --><p> ls -l /dev </p><div class="fragment"><div class="line">, at the entries for ttyAMA0 and ttyS0 you don&#39;t see a `serial0 -&gt;` or `serial1 -&gt;`, the operation has been successful.</div><div class="line">&lt;br&gt;</div><div class="line">**Note** : as with any significant change, reboot your Pi for changes to apply by typing</div></div><!-- fragment --><p> sudo reboot </p><div class="fragment"><div class="line">### Building the project</div><div class="line">Once the UART communication has been enabled on the PI, the project needs to be built to be ran. This can be done by navigating into the root folder of the project repository, and running the `buildBeeSafe.sh` script.</div><div class="line">&lt;br&gt;</div><div class="line">**Note** : If you want to test the project, uncomment the line that runs the tests in the build script.</div><div class="line">&lt;br&gt;</div><div class="line">It navigates into the build directory, runs CMake, then creates executables of the program by running make. Running CTest runs the executables of the tests to see if the code implementation is correct and it passes the specified tests.</div><div class="line">&lt;br&gt;</div><div class="line"></div><div class="line">### Bootloading</div><div class="line">As this hardware requires the project to automatically run on the hardware (minimising the technical knowledge required by parents to set up), the build and run process is automated by the bootloader script that is included in the root folder of the project. This following section explains how to set up bootloading on a Raspberry Pi, specifically for this project. If you wish to understand the HOW and WHY behind the script, please refer back to the chapters above.</div><div class="line"></div><div class="line">#### Creating a bootloader</div><div class="line">To create the bootloader, there are a number of short steps to be taken that ensure that the service can run upon the detection of a network. This was designed with the fact that the device would need to be set up at home by the parent, to configure the home location/safe zone.</div><div class="line">&lt;br&gt;</div><div class="line">* First, create your script, and compile it with a compiler of your choice.</div><div class="line">* Then create a service for it by typing</div></div><!-- fragment --><p> sudo systemctl edit &ndash;force &ndash;full yourservicename.service </p><div class="fragment"><div class="line">* </div><div class="line">Then create a service file for it by writing the following code:</div></div><!-- fragment --><p> [Unit] Description=My Systemd Test Service Wants=network-online.target After=network-online.target</p>
<p>[Service] Type=simple User=pi WorkingDirectory=/home/pi ExecStart=/home/pi/runname</p>
<p>[Install] WantedBy=multi-user.target </p><div class="fragment"><div class="line">* Once that&#39;s saved, ensure your service is in place</div></div><!-- fragment --><p> systemctl status yourservicename.service </p><div class="fragment"><div class="line">* Then enable and start your service</div></div><!-- fragment --><p> sudo systemctl enable yourservicename.service sudo systemctl start yourservicename.service </p><div class="fragment"><div class="line">* To ensure all the changes are saved, type</div></div><!-- fragment --><p> sudo systemctl reboot </p><div class="fragment"><div class="line">* If you need to edit your service file, type</div></div><!-- fragment --><p> sudo systemctl edit &ndash;full yourservicename.service </p><div class="fragment"><div class="line">* and make sure you restart the service for changes to apply</div></div><!-- fragment --><p> sudo systemctl restart yourservicename.service ```</p>
<h4>The bootloader script</h4>
<p>To run the project via bootloader, follow the above guide. The script you should create is the runBeeSafe.sh file in the root repository of this project. If you clone the project from github, make sure you copy the script to the root home folder of the Pi user. After having set up the bootloader including the script name upon setup, the program will run every time the Pi is powered up and it detects internet connection. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
